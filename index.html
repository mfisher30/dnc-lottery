<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Degens n' Coffee â€” Alliance Lottery</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap');

:root {
  --bg-base:#0a0c12;--bg-card:#141720;--bg-card2:#1a1f2e;
  --border:#1e2535;--border-bright:#2a3045;
  --gold:#c8973a;--gold-light:#e8b84b;--gold-dim:#5a3f15;
  --purple:#6c3fc5;--purple-light:#9b6ef0;
  --blue:#1e6fa8;--blue-light:#3a9fd4;
  --green:#1a7a4a;--green-light:#2db870;
  --red:#8a2020;--red-light:#d94444;
  --text-primary:#e8eaf0;--text-secondary:#8a90a8;--text-dim:#4a5068;
  --legendary:#c8973a;--epic:#9b6ef0;--elite:#3a9fd4;--advanced:#2db870;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg-base);color:var(--text-primary);font-family:'Rajdhani',sans-serif;display:flex;flex-direction:column;}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;}
::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-thumb{background:var(--border-bright);border-radius:2px;}

/* TITLEBAR */
.titlebar{background:linear-gradient(90deg,#080a10,#0d1020,#0a0d18);border-bottom:1px solid var(--border);display:flex;align-items:stretch;height:52px;flex-shrink:0;position:relative;}
.titlebar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold-dim),transparent);}
.tb-logo{display:flex;align-items:center;gap:10px;padding:0 18px;border-right:1px solid var(--border);flex-shrink:0;}
.logo-icon{width:30px;height:30px;background:linear-gradient(135deg,var(--gold),#5a3f15);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:15px;box-shadow:0 0 14px rgba(200,151,58,.35);}
.logo-text{font-family:'Cinzel',serif;font-size:12px;font-weight:600;color:var(--gold-light);line-height:1.3;}
.logo-text small{display:block;font-size:9px;color:var(--text-dim);font-family:'Share Tech Mono',monospace;letter-spacing:2px;}
.tb-right{margin-left:auto;display:flex;align-items:center;gap:8px;padding:0 14px;}
.btn-tb{background:var(--bg-card2);border:1px solid var(--border-bright);color:var(--text-secondary);font-family:'Rajdhani',sans-serif;font-weight:700;font-size:10px;letter-spacing:1px;text-transform:uppercase;border-radius:5px;padding:5px 12px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;white-space:nowrap;}
.btn-tb:hover{border-color:var(--gold-dim);color:var(--gold);}
.sync-indicator{display:flex;align-items:center;gap:5px;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:1px;}
.sync-dot{width:6px;height:6px;border-radius:50%;background:var(--text-dim);transition:all .3s;flex-shrink:0;}
.sync-dot.ok{background:var(--green-light);box-shadow:0 0 6px var(--green-light);}
.sync-dot.err{background:var(--red-light);}
.sync-dot.loading{background:var(--gold);animation:pdot 1s ease-in-out infinite;}
@keyframes pdot{0%,100%{opacity:.4;}50%{opacity:1;}}

/* LAYOUT */
.app-body{display:grid;grid-template-columns:260px 1fr 280px;flex:1;min-height:0;overflow:hidden;}

/* PANEL */
.panel{display:flex;flex-direction:column;overflow:hidden;}
.panel-left{border-right:1px solid var(--border);}
.panel-right{border-left:1px solid var(--border);}
.panel-hdr{padding:11px 13px 9px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.panel-title{font-family:'Cinzel',serif;font-size:10px;letter-spacing:2px;color:var(--text-secondary);text-transform:uppercase;}
.badge{background:var(--bg-card2);border:1px solid var(--border-bright);color:var(--text-secondary);font-family:'Share Tech Mono',monospace;font-size:10px;padding:2px 8px;border-radius:10px;}
.badge.gold{border-color:var(--gold-dim);color:var(--gold);background:rgba(200,151,58,.08);}

/* LEFT */
.search-wrap{padding:8px 8px 4px;flex-shrink:0;}
.search-bar{background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:5px;display:flex;align-items:center;gap:6px;padding:6px 9px;}
.search-bar input{background:none;border:none;outline:none;color:var(--text-primary);font-family:'Rajdhani',sans-serif;font-size:13px;flex:1;min-width:0;}
.search-bar input::placeholder{color:var(--text-dim);}
.participant-scroll{flex:1;overflow-y:auto;padding:2px 5px;}
.participant-item{display:flex;align-items:center;gap:7px;padding:5px 7px;border-radius:5px;transition:background .15s;}
.participant-item:hover{background:var(--bg-card2);}
.participant-item.won{opacity:.38;}
.p-avatar{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:800;flex-shrink:0;}
.p-name{font-size:13px;font-weight:500;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.p-won-tag{font-size:8px;font-family:'Share Tech Mono',monospace;color:var(--gold-dim);letter-spacing:1px;flex-shrink:0;}
.p-del{color:var(--text-dim);font-size:11px;opacity:0;cursor:pointer;padding:2px 4px;transition:all .15s;flex-shrink:0;border:none;background:none;}
.participant-item:hover .p-del{opacity:1;}
.p-del:hover{color:var(--red-light);}
.list-empty{padding:20px 12px;text-align:center;color:var(--text-dim);font-size:11px;letter-spacing:1.5px;text-transform:uppercase;line-height:1.8;}
.add-area{padding:7px;border-top:1px solid var(--border);flex-shrink:0;}
.add-row{display:flex;gap:5px;}
.input-field{flex:1;background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:5px;color:var(--text-primary);font-family:'Rajdhani',sans-serif;font-size:13px;padding:6px 9px;outline:none;transition:border-color .2s;min-width:0;}
.input-field:focus{border-color:var(--gold-dim);}
.input-field::placeholder{color:var(--text-dim);}
.btn-add{width:30px;height:30px;background:rgba(200,151,58,.1);border:1px solid var(--gold-dim);border-radius:5px;color:var(--gold);font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.btn-add:hover{background:rgba(200,151,58,.22);}

/* CENTER */
.panel-center{background:var(--bg-base);display:flex;flex-direction:column;overflow:hidden;}
.prize-config{padding:11px 14px;border-bottom:1px solid var(--border);flex-shrink:0;}
.config-label{font-size:9px;letter-spacing:2px;color:var(--text-dim);text-transform:uppercase;font-family:'Share Tech Mono',monospace;margin-bottom:7px;}
.tiers-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:9px;}
.prize-tier{display:flex;align-items:center;gap:5px;background:var(--bg-card);border:1px solid var(--border-bright);border-radius:6px;padding:6px 10px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;user-select:none;}
.prize-tier::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;}
.prize-tier.legendary::before{background:var(--legendary);}
.prize-tier.epic::before{background:var(--epic);}
.prize-tier.elite::before{background:var(--elite);}
.prize-tier.advanced::before{background:var(--advanced);}
.prize-tier:hover{background:var(--bg-card2);}
.prize-tier.off{opacity:.28;}
.prize-tier:active{transform:scale(.97);}
.tier-check{width:13px;height:13px;border-radius:3px;border:1.5px solid var(--border-bright);display:flex;align-items:center;justify-content:center;font-size:8px;flex-shrink:0;}
.prize-tier:not(.off) .tier-check{background:rgba(200,151,58,.15);border-color:var(--gold-dim);color:var(--gold);}
.tier-icon{font-size:13px;}
.tier-name{font-size:11px;font-weight:700;}
.prize-tier.legendary .tier-name{color:var(--legendary);}
.prize-tier.epic .tier-name{color:var(--epic);}
.prize-tier.elite .tier-name{color:var(--elite);}
.prize-tier.advanced .tier-name{color:var(--advanced);}
.tier-qty-lbl{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--text-dim);}
.custom-row{display:flex;align-items:center;gap:6px;}
.custom-label{font-size:9px;color:var(--text-dim);letter-spacing:1.5px;text-transform:uppercase;white-space:nowrap;font-family:'Share Tech Mono',monospace;}
.qty-input{width:44px;text-align:center;padding:5px 4px;font-size:12px;}
.btn-sm-add{width:28px;height:28px;background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:5px;color:var(--text-secondary);font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.btn-sm-add:hover{border-color:var(--gold-dim);color:var(--gold);}
.custom-chips{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px;}
.custom-chip{display:flex;align-items:center;gap:4px;background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:12px;padding:3px 8px;font-size:11px;color:var(--text-secondary);}
.cc-del{cursor:pointer;color:var(--text-dim);font-size:10px;margin-left:3px;border:none;background:none;line-height:1;}
.cc-del:hover{color:var(--red-light);}

/* RUN BAR */
.run-bar{padding:11px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;flex-shrink:0;}
@keyframes glow{0%,100%{box-shadow:0 0 16px rgba(200,151,58,.2);}50%{box-shadow:0 0 34px rgba(200,151,58,.5);}}
.btn-run{background:linear-gradient(135deg,#7a5515,var(--gold),#7a5515);background-size:200%;color:#0a0c12;font-family:'Rajdhani',sans-serif;font-weight:800;font-size:13px;letter-spacing:2.5px;text-transform:uppercase;border:none;border-radius:7px;padding:10px 26px;cursor:pointer;transition:all .3s;animation:glow 3s ease-in-out infinite;}
.btn-run:hover{background-position:right;box-shadow:0 0 40px rgba(200,151,58,.55);transform:translateY(-1px);}
.btn-run:disabled{opacity:.35;cursor:not-allowed;animation:none;transform:none;}
.btn-newround{background:var(--bg-card);border:1px solid var(--border-bright);color:var(--text-secondary);font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:1px;text-transform:uppercase;border-radius:6px;padding:8px 14px;cursor:pointer;transition:all .2s;}
.btn-newround:hover{border-color:var(--blue-light);color:var(--blue-light);}
.run-info{margin-left:auto;text-align:right;}
.run-round{font-family:'Share Tech Mono',monospace;font-size:18px;color:var(--gold-light);line-height:1;}
.run-sub{font-size:9px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
.eligible-lbl{font-size:10px;color:var(--text-dim);font-family:'Share Tech Mono',monospace;margin-top:2px;}

/* RESULTS */
.results-area{flex:1;overflow-y:auto;padding:14px;}
.results-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:10px;color:var(--text-dim);text-align:center;}
.results-empty .big-icon{font-size:48px;opacity:.25;}
.results-empty p{font-size:11px;letter-spacing:2px;text-transform:uppercase;}
.results-grid{display:grid;gap:10px;}
.result-card{background:var(--bg-card);border:1px solid var(--border-bright);border-radius:9px;overflow:hidden;position:relative;opacity:0;transform:translateY(14px);transition:opacity .45s ease,transform .45s ease;}
.result-card.visible{opacity:1;transform:translateY(0);}
.result-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;}
.result-card.legendary::before{background:linear-gradient(180deg,var(--gold-light),var(--gold-dim));}
.result-card.epic::before{background:linear-gradient(180deg,var(--purple-light),var(--purple));}
.result-card.elite::before{background:linear-gradient(180deg,var(--blue-light),var(--blue));}
.result-card.advanced::before{background:linear-gradient(180deg,var(--green-light),var(--green));}
.result-card.custom-tier::before{background:linear-gradient(180deg,#e8eaf0,#4a5068);}
.card-hdr{display:flex;align-items:center;gap:8px;padding:10px 12px 8px 16px;border-bottom:1px solid var(--border);}
.card-badge{font-family:'Cinzel',serif;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;padding:2px 8px;border-radius:3px;border:1px solid;}
.legendary .card-badge{color:var(--legendary);border-color:var(--gold-dim);background:rgba(200,151,58,.08);}
.epic .card-badge{color:var(--purple-light);border-color:var(--purple);background:rgba(108,63,197,.1);}
.elite .card-badge{color:var(--elite);border-color:var(--blue);background:rgba(30,111,168,.1);}
.advanced .card-badge{color:var(--advanced);border-color:var(--green);background:rgba(26,122,74,.1);}
.custom-tier .card-badge{color:var(--text-secondary);border-color:var(--border-bright);background:var(--bg-card2);}
.card-count{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--text-dim);margin-left:auto;}
.card-winners{padding:10px 16px;display:flex;flex-wrap:wrap;gap:6px;}
.winner-chip{display:flex;align-items:center;gap:5px;background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:16px;padding:4px 10px 4px 6px;opacity:0;transform:scale(.88);transition:opacity .3s ease,transform .3s ease;}
.winner-chip.visible{opacity:1;transform:scale(1);}
.chip-avatar{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:800;flex-shrink:0;}
.chip-name{font-size:12px;font-weight:600;}

/* DISCORD BAR */
.discord-bar{padding:8px 14px;border-top:1px solid var(--border);display:flex;align-items:center;gap:8px;flex-shrink:0;}
.btn-discord{background:linear-gradient(135deg,#4752c4,#5865f2);color:#fff;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:1.5px;text-transform:uppercase;border:none;border-radius:5px;padding:7px 16px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px;}
.btn-discord:hover{opacity:.85;transform:translateY(-1px);}
.btn-discord:disabled{opacity:.3;cursor:not-allowed;transform:none;}
.copy-confirm{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--green-light);letter-spacing:1px;opacity:0;transition:opacity .3s;}
.copy-confirm.show{opacity:1;}

/* RIGHT: HISTORY */
.history-scroll{flex:1;overflow-y:auto;padding:4px 6px;}
.history-round-block{margin-bottom:10px;}
.history-round-hdr{display:flex;align-items:center;gap:5px;padding:5px 6px;border-bottom:1px solid var(--border);margin-bottom:3px;}
.hr-label{font-family:'Cinzel',serif;font-size:9px;letter-spacing:1.5px;color:var(--text-dim);text-transform:uppercase;}
.hr-num{font-family:'Share Tech Mono',monospace;color:var(--gold-dim);font-size:10px;}
.hr-date{margin-left:auto;font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--text-dim);}
.history-entry{display:flex;align-items:center;gap:6px;padding:4px 6px;border-radius:4px;transition:background .15s;}
.history-entry:hover{background:var(--bg-card2);}
.he-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.he-dot.legendary{background:var(--legendary);}
.he-dot.epic{background:var(--purple-light);}
.he-dot.elite{background:var(--elite);}
.he-dot.advanced{background:var(--advanced);}
.he-dot.custom{background:var(--text-secondary);}
.he-name{font-size:12px;font-weight:500;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.he-prize{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--text-dim);white-space:nowrap;}
.history-empty-msg{padding:24px 12px;text-align:center;color:var(--text-dim);font-size:11px;letter-spacing:1.5px;text-transform:uppercase;line-height:1.8;}
.history-footer{border-top:1px solid var(--border);padding:8px 12px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.hf-stat{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:1px;}
.btn-clear{background:none;border:1px solid var(--border-bright);color:var(--text-dim);font-family:'Rajdhani',sans-serif;font-weight:600;font-size:10px;letter-spacing:1px;text-transform:uppercase;border-radius:4px;padding:4px 10px;cursor:pointer;transition:all .2s;}
.btn-clear:hover{border-color:var(--red-light);color:var(--red-light);}

/* MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);display:flex;align-items:center;justify-content:center;z-index:500;backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .25s;}
.overlay.show{opacity:1;pointer-events:all;}
.modal{background:var(--bg-card);border:1px solid var(--border-bright);border-radius:10px;padding:24px;width:480px;max-width:95vw;transform:translateY(12px);transition:transform .25s;max-height:90vh;overflow-y:auto;}
.overlay.show .modal{transform:translateY(0);}
.modal-title{font-family:'Cinzel',serif;font-size:14px;color:var(--gold-light);margin-bottom:4px;letter-spacing:1px;}
.modal-sub{font-size:11px;color:var(--text-dim);letter-spacing:1px;margin-bottom:18px;font-family:'Share Tech Mono',monospace;}
.modal-section{margin-bottom:16px;}
.modal-section-title{font-size:9px;letter-spacing:2px;color:var(--text-dim);text-transform:uppercase;font-family:'Share Tech Mono',monospace;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid var(--border);}
.modal-row{display:flex;flex-direction:column;gap:4px;margin-bottom:10px;}
.modal-label{font-size:12px;color:var(--text-secondary);}
.modal-input{background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:5px;color:var(--text-primary);font-family:'Share Tech Mono',monospace;font-size:12px;padding:8px 10px;outline:none;transition:border-color .2s;width:100%;}
.modal-input:focus{border-color:var(--gold-dim);}
.modal-input::placeholder{color:var(--text-dim);}
.modal-hint{font-size:10px;color:var(--text-dim);line-height:1.6;margin-top:4px;}
.modal-hint a{color:var(--gold-dim);text-decoration:none;}
.modal-hint a:hover{color:var(--gold);}
.modal-btns{display:flex;gap:8px;justify-content:flex-end;margin-top:18px;}
.btn-modal{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:12px;letter-spacing:1px;text-transform:uppercase;border-radius:5px;padding:8px 18px;cursor:pointer;transition:all .2s;border:1px solid transparent;}
.btn-modal.cancel{background:var(--bg-card2);border-color:var(--border-bright);color:var(--text-secondary);}
.btn-modal.cancel:hover{border-color:var(--text-dim);}
.btn-modal.save{background:linear-gradient(135deg,var(--gold-dim),var(--gold));color:#0a0c12;border-color:var(--gold);}
.btn-modal.save:hover{opacity:.85;}
.btn-modal.danger{background:var(--red);color:var(--text-primary);border-color:var(--red-light);}
.btn-modal.danger:hover{background:var(--red-light);}
.modal-body-text{font-size:13px;color:var(--text-secondary);line-height:1.6;margin:10px 0 18px;}

/* STATUS TOAST */
.toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:var(--bg-card2);border:1px solid var(--border-bright);border-radius:6px;padding:8px 18px;font-family:'Share Tech Mono',monospace;font-size:11px;letter-spacing:1px;z-index:600;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap;}
.toast.show{opacity:1;}
.toast.ok{border-color:var(--green);color:var(--green-light);}
.toast.err{border-color:var(--red-light);color:var(--red-light);}
.toast.info{border-color:var(--gold-dim);color:var(--gold);}
</style>
</head>
<body>

<!-- TITLEBAR -->
<div class="titlebar">
  <div class="tb-logo">
    <div class="logo-icon">â˜•</div>
    <div class="logo-text">Degens n' Coffee<small>Alliance Lottery System</small></div>
  </div>
  <div class="tb-right">
    <div class="sync-indicator">
      <div class="sync-dot" id="sync-dot"></div>
      <span id="sync-label">Not configured</span>
    </div>
    <button class="btn-tb" onclick="openSettings()">âš™ Settings</button>
  </div>
</div>

<!-- BODY -->
<div class="app-body">

  <!-- LEFT: PARTICIPANTS -->
  <div class="panel panel-left">
    <div class="panel-hdr">
      <span class="panel-title">Participants</span>
      <span class="badge gold" id="p-badge">0</span>
    </div>
    <div class="search-wrap">
      <div class="search-bar">
        <span style="color:var(--text-dim);font-size:11px;">ğŸ”</span>
        <input type="text" id="search-input" placeholder="Filter namesâ€¦" oninput="renderParticipants()">
      </div>
    </div>
    <div class="participant-scroll" id="participant-list"></div>
    <div class="add-area">
      <div class="add-row">
        <input class="input-field" type="text" id="new-name" placeholder="Add participant nameâ€¦" onkeydown="if(event.key==='Enter')addParticipant()">
        <button class="btn-add" onclick="addParticipant()">+</button>
      </div>
    </div>
  </div>

  <!-- CENTER -->
  <div class="panel panel-center">
    <div class="prize-config">
      <div class="config-label">Prize Tiers â€” click to toggle</div>
      <div class="tiers-row">
        <div class="prize-tier legendary" id="tier-legendary" onclick="toggleTier('legendary')">
          <div class="tier-check">âœ“</div><span class="tier-icon">ğŸ‘‘</span><span class="tier-name">Legendary</span><span class="tier-qty-lbl">Ã—1</span>
        </div>
        <div class="prize-tier epic" id="tier-epic" onclick="toggleTier('epic')">
          <div class="tier-check">âœ“</div><span class="tier-icon">ğŸ’</span><span class="tier-name">Epic</span><span class="tier-qty-lbl">Ã—2</span>
        </div>
        <div class="prize-tier elite" id="tier-elite" onclick="toggleTier('elite')">
          <div class="tier-check">âœ“</div><span class="tier-icon">âš”ï¸</span><span class="tier-name">Elite</span><span class="tier-qty-lbl">Ã—5</span>
        </div>
        <div class="prize-tier advanced" id="tier-advanced" onclick="toggleTier('advanced')">
          <div class="tier-check">âœ“</div><span class="tier-icon">ğŸ›¡ï¸</span><span class="tier-name">Advanced</span><span class="tier-qty-lbl">Ã—10</span>
        </div>
      </div>
      <div class="custom-row">
        <span class="custom-label">+ Custom:</span>
        <input class="input-field" type="text" id="custom-name" placeholder="Prize nameâ€¦" style="max-width:148px;font-size:12px;padding:5px 8px;">
        <input class="input-field qty-input" type="number" id="custom-qty" value="1" min="1" max="50">
        <button class="btn-sm-add" onclick="addCustomPrize()">+</button>
      </div>
      <div class="custom-chips" id="custom-chips"></div>
    </div>

    <div class="run-bar">
      <button class="btn-run" id="btn-run" onclick="runLottery()">âš¡ Run Lottery</button>
      <button class="btn-newround" onclick="newRound()">â†º New Round</button>
      <div class="run-info">
        <div class="run-round" id="round-display">Round 1</div>
        <div class="run-sub">Current Round</div>
        <div class="eligible-lbl" id="eligible-lbl">0 eligible</div>
      </div>
    </div>

    <div class="results-area" id="results-area">
      <div class="results-empty" id="results-empty">
        <div class="big-icon">ğŸ²</div>
        <p>Configure prizes &amp; click Run Lottery</p>
        <p style="font-size:10px;margin-top:4px;opacity:.6;">Winners appear here with animation</p>
      </div>
      <div class="results-grid" id="results-grid" style="display:none;"></div>
    </div>

    <div class="discord-bar">
      <button class="btn-discord" id="btn-discord" onclick="copyDiscord()" disabled>ğŸ’¬ Copy for Discord</button>
      <span class="copy-confirm" id="copy-confirm">âœ“ Copied to clipboard!</span>
    </div>
  </div>

  <!-- RIGHT: HISTORY -->
  <div class="panel panel-right">
    <div class="panel-hdr">
      <span class="panel-title">Winner History</span>
      <span class="badge" id="history-badge">0</span>
    </div>
    <div class="history-scroll" id="history-list">
      <div class="history-empty-msg">No winners recorded yet.<br>Run your first lottery!</div>
    </div>
    <div class="history-footer">
      <span class="hf-stat" id="hf-stat">0 rounds â€¢ 0 winners</span>
      <button class="btn-clear" onclick="confirmClearHistory()">Clear All</button>
    </div>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div class="overlay" id="settings-overlay">
  <div class="modal">
    <div class="modal-title">âš™ Settings</div>
    <div class="modal-sub">GitHub Integration</div>

    <div class="modal-section">
      <div class="modal-section-title">Repository</div>
      <div class="modal-row">
        <label class="modal-label">GitHub Username</label>
        <input class="modal-input" type="text" id="cfg-owner" placeholder="yourusername">
      </div>
      <div class="modal-row">
        <label class="modal-label">Repository Name</label>
        <input class="modal-input" type="text" id="cfg-repo" placeholder="dnc-lottery">
      </div>
      <div class="modal-row">
        <label class="modal-label">Branch</label>
        <input class="modal-input" type="text" id="cfg-branch" placeholder="main">
      </div>
    </div>

    <div class="modal-section">
      <div class="modal-section-title">Personal Access Token (required for editing names)</div>
      <div class="modal-row">
        <label class="modal-label">GitHub PAT</label>
        <input class="modal-input" type="password" id="cfg-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
        <div class="modal-hint">
          Without a token the app is read-only. To add/remove participants, generate a <strong>Fine-Grained Token</strong> with <strong>Contents: Read &amp; Write</strong> on your repo.<br><br>
          <a href="https://github.com/settings/tokens?type=beta" target="_blank">â†’ Generate token on GitHub Settings</a>
        </div>
      </div>
    </div>

    <div class="modal-section">
      <div class="modal-section-title">Actions</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn-tb" style="padding:7px 14px;" onclick="testConnection()">ğŸ”Œ Test Connection</button>
        <button class="btn-tb" style="padding:7px 14px;" onclick="forceSyncAll()">ğŸ”„ Force Re-sync</button>
      </div>
    </div>

    <div class="modal-btns">
      <button class="btn-modal cancel" onclick="closeSettings()">Cancel</button>
      <button class="btn-modal save" onclick="saveSettings()">Save &amp; Connect</button>
    </div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="overlay" id="confirm-overlay">
  <div class="modal" style="width:360px;">
    <div class="modal-title" id="confirm-title">Confirm</div>
    <div class="modal-body-text" id="confirm-body"></div>
    <div class="modal-btns">
      <button class="btn-modal cancel" onclick="closeConfirm()">Cancel</button>
      <button class="btn-modal danger" id="confirm-ok">Confirm</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const state = {
  participants: [],   // [{name, color}]
  winners: new Set(), // names who won this round
  roundNumber: 1,
  history: [],        // [{round, date, entries:[{name,prize,tierClass}]}]
  customPrizes: [],   // [{name, qty}]
  tierEnabled: {legendary:true, epic:true, elite:true, advanced:true},
  lastResults: null,
};

let cfg = {owner:'', repo:'', branch:'main', token:''};
let fileSHAs = {participants:null, history:null};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIER DEFINITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TIERS = [
  {id:'legendary', icon:'ğŸ‘‘', label:'Legendary', qty:1},
  {id:'epic',      icon:'ğŸ’', label:'Epic',      qty:2},
  {id:'elite',     icon:'âš”ï¸', label:'Elite',     qty:5},
  {id:'advanced',  icon:'ğŸ›¡ï¸', label:'Advanced',  qty:10},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COLORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PALETTE = ['#6c3fc5','#c8973a','#1e6fa8','#2db870','#d94444','#9b6ef0','#3a9fd4','#e8b84b','#1a7a4a','#a03060'];
function colorFor(name) {
  let h = 0;
  for (let i = 0; i < name.length; i++) h = (h * 31 + name.charCodeAt(i)) & 0xFFFFFF;
  return PALETTE[Math.abs(h) % PALETTE.length];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GITHUB API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ghHeaders() {
  const h = {'Accept':'application/vnd.github+json','X-GitHub-Api-Version':'2022-11-28'};
  if (cfg.token) h['Authorization'] = `Bearer ${cfg.token}`;
  return h;
}

async function ghGet(path) {
  const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${path}?ref=${cfg.branch}&t=${Date.now()}`;
  const res = await fetch(url, {headers: ghHeaders()});
  if (!res.ok) throw new Error(`GitHub ${path}: ${res.status} ${res.statusText}`);
  return res.json();
}

async function ghPut(path, data, sha, message) {
  if (!cfg.token) throw new Error('No Personal Access Token â€” read-only mode');
  const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
  const body = {message, content: encoded, branch: cfg.branch};
  if (sha) body.sha = sha;
  const res = await fetch(`https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${path}`, {
    method:'PUT', headers:{...ghHeaders(),'Content-Type':'application/json'}, body:JSON.stringify(body)
  });
  if (!res.ok) {
    const e = await res.json().catch(()=>({}));
    throw new Error(e.message || `GitHub write failed: ${res.status}`);
  }
  const d = await res.json();
  return d.content.sha;
}

function b64decode(str) {
  return JSON.parse(decodeURIComponent(escape(atob(str.replace(/\n/g,'')))));
}

async function loadFromGitHub() {
  if (!cfg.owner || !cfg.repo) return;
  setSyncStatus('loading','Syncingâ€¦');
  try {
    const pf = await ghGet('participants.json');
    fileSHAs.participants = pf.sha;
    const pData = b64decode(pf.content);
    state.participants = pData.map(n =>
      typeof n === 'string' ? {name:n, color:colorFor(n)} : {name:n.name, color:n.color||colorFor(n.name)}
    );

    const hf = await ghGet('history.json');
    fileSHAs.history = hf.sha;
    state.history = b64decode(hf.content);

    if (state.history.length > 0) {
      state.roundNumber = Math.max(...state.history.map(r=>r.round)) + 1;
    }

    setSyncStatus('ok','Synced');
    renderAll();
    showToast('âœ“ Loaded from GitHub','ok');
  } catch(e) {
    setSyncStatus('err','Sync error');
    showToast('âš  '+e.message,'err');
  }
}

async function saveParticipants(msg) {
  if (!cfg.owner || !cfg.repo || !cfg.token) return;
  setSyncStatus('loading','Savingâ€¦');
  try {
    const data = state.participants.map(p=>p.name);
    fileSHAs.participants = await ghPut('participants.json', data, fileSHAs.participants, msg);
    setSyncStatus('ok','Saved');
  } catch(e) {
    setSyncStatus('err','Save failed');
    showToast('âš  '+e.message,'err');
  }
}

async function saveHistory(msg) {
  if (!cfg.owner || !cfg.repo || !cfg.token) return;
  setSyncStatus('loading','Savingâ€¦');
  try {
    fileSHAs.history = await ghPut('history.json', state.history, fileSHAs.history, msg);
    setSyncStatus('ok','Saved');
  } catch(e) {
    setSyncStatus('err','Save failed');
    showToast('âš  '+e.message,'err');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadCfg() {
  try { const s=localStorage.getItem('dnc-cfg'); if(s) cfg={...cfg,...JSON.parse(s)}; } catch(e){}
  const rn=localStorage.getItem('dnc-round'); if(rn) state.roundNumber=parseInt(rn)||1;
}
function saveCfg() { localStorage.setItem('dnc-cfg',JSON.stringify(cfg)); }
function openSettings() {
  document.getElementById('cfg-owner').value=cfg.owner;
  document.getElementById('cfg-repo').value=cfg.repo;
  document.getElementById('cfg-branch').value=cfg.branch||'main';
  document.getElementById('cfg-token').value=cfg.token;
  document.getElementById('settings-overlay').classList.add('show');
}
function closeSettings() { document.getElementById('settings-overlay').classList.remove('show'); }
async function saveSettings() {
  cfg.owner=document.getElementById('cfg-owner').value.trim();
  cfg.repo=document.getElementById('cfg-repo').value.trim();
  cfg.branch=document.getElementById('cfg-branch').value.trim()||'main';
  cfg.token=document.getElementById('cfg-token').value.trim();
  saveCfg(); closeSettings(); await loadFromGitHub();
}
async function testConnection() {
  const owner=document.getElementById('cfg-owner').value.trim();
  const repo=document.getElementById('cfg-repo').value.trim();
  const branch=document.getElementById('cfg-branch').value.trim()||'main';
  const token=document.getElementById('cfg-token').value.trim();
  if(!owner||!repo){showToast('Enter username and repo first','err');return;}
  showToast('Testing connectionâ€¦','info');
  try {
    const h={'Accept':'application/vnd.github+json'};
    if(token) h['Authorization']=`Bearer ${token}`;
    const res=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/participants.json?ref=${branch}`,{headers:h});
    if(res.status===200) showToast('âœ“ Connection successful!','ok');
    else if(res.status===404) showToast('âš  File not found in repo','err');
    else if(res.status===401) showToast('âš  Token invalid or expired','err');
    else showToast(`âš  Status ${res.status}`,'err');
  } catch(e){showToast('âš  Network error','err');}
}
async function forceSyncAll() { closeSettings(); await loadFromGitHub(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICIPANTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderParticipants() {
  const list=document.getElementById('participant-list');
  const q=document.getElementById('search-input').value.toLowerCase();
  const filtered=state.participants.filter(p=>p.name.toLowerCase().includes(q));
  if(!filtered.length) {
    list.innerHTML=`<div class="list-empty">${!state.participants.length?'No participants yet.<br>Add names below.':'No matches found.'}</div>`;
  } else {
    list.innerHTML=filtered.map(p=>{
      const won=state.winners.has(p.name);
      return `<div class="participant-item ${won?'won':''}">
        <div class="p-avatar" style="background:${p.color}22;color:${p.color};border:1px solid ${p.color}44">${p.name[0].toUpperCase()}</div>
        <span class="p-name">${esc(p.name)}</span>
        ${won?'<span class="p-won-tag">WON</span>':''}
        <button class="p-del" onclick="removeParticipant('${escQ(p.name)}')" title="Remove">âœ•</button>
      </div>`;
    }).join('');
  }
  const eligible=state.participants.filter(p=>!state.winners.has(p.name)).length;
  document.getElementById('p-badge').textContent=state.participants.length;
  document.getElementById('eligible-lbl').textContent=`${eligible} eligible`;
}

async function addParticipant() {
  const inp=document.getElementById('new-name');
  const name=inp.value.trim();
  if(!name){return;}
  if(state.participants.find(p=>p.name.toLowerCase()===name.toLowerCase())){
    showToast('Name already in list','err'); return;
  }
  state.participants.push({name, color:colorFor(name)});
  inp.value='';
  renderParticipants();
  await saveParticipants(`Add: ${name}`);
}

async function removeParticipant(name) {
  state.participants=state.participants.filter(p=>p.name!==name);
  state.winners.delete(name);
  renderParticipants();
  await saveParticipants(`Remove: ${name}`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRIZE TIERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTier(id) {
  state.tierEnabled[id]=!state.tierEnabled[id];
  const el=document.getElementById(`tier-${id}`);
  el.classList.toggle('off',!state.tierEnabled[id]);
  el.querySelector('.tier-check').textContent=state.tierEnabled[id]?'âœ“':'';
}

function addCustomPrize() {
  const nameEl=document.getElementById('custom-name');
  const qtyEl=document.getElementById('custom-qty');
  const name=nameEl.value.trim();
  const qty=Math.max(1,Math.min(50,parseInt(qtyEl.value)||1));
  if(!name){showToast('Enter a prize name','err');return;}
  state.customPrizes.push({name,qty});
  nameEl.value=''; qtyEl.value='1';
  renderCustomChips();
}

function removeCustomPrize(i) {
  state.customPrizes.splice(i,1);
  renderCustomChips();
}

function renderCustomChips() {
  document.getElementById('custom-chips').innerHTML=state.customPrizes.map((p,i)=>
    `<div class="custom-chip">${esc(p.name)} Ã—${p.qty}<button class="cc-del" onclick="removeCustomPrize(${i})">âœ•</button></div>`
  ).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOTTERY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runLottery() {
  const activeTiers=TIERS.filter(t=>state.tierEnabled[t.id]);
  const allTiers=[
    ...activeTiers,
    ...state.customPrizes.map(c=>({id:'custom',icon:'ğŸ',label:c.name,qty:c.qty,isCustom:true}))
  ];
  if(!allTiers.length){showToast('Enable at least one prize tier','err');return;}

  const pool=state.participants.filter(p=>!state.winners.has(p.name));
  const needed=allTiers.reduce((s,t)=>s+t.qty,0);
  if(!pool.length){showToast('No eligible participants â€” start a new round','err');return;}
  if(pool.length<needed){showToast(`Need ${needed} participants, only ${pool.length} eligible`,'err');return;}

  // Fisher-Yates shuffle
  const shuffled=[...pool];
  for(let i=shuffled.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]];
  }

  document.getElementById('results-empty').style.display='none';
  const grid=document.getElementById('results-grid');
  grid.style.display='grid'; grid.innerHTML='';
  document.getElementById('btn-run').disabled=true;

  let idx=0;
  const roundEntries=[];
  state.lastResults={round:state.roundNumber, tiers:[]};

  for(let ti=0;ti<allTiers.length;ti++){
    const tier=allTiers[ti];
    const tierWinners=[];
    for(let w=0;w<tier.qty;w++){
      const winner=shuffled[idx++];
      tierWinners.push(winner);
      state.winners.add(winner.name);
      roundEntries.push({name:winner.name, prize:tier.label, tierClass:tier.isCustom?'custom':tier.id});
    }
    state.lastResults.tiers.push({...tier, winners:tierWinners});

    const card=document.createElement('div');
    const tierClass=tier.isCustom?'custom-tier':tier.id;
    card.className=`result-card ${tierClass}`;
    card.innerHTML=`
      <div class="card-hdr">
        <span style="font-size:16px">${tier.icon}</span>
        <span class="card-badge">${esc(tier.label)}</span>
        <span class="card-count">${tier.qty} winner${tier.qty!==1?'s':''}</span>
      </div>
      <div class="card-winners" id="cw-${ti}"></div>`;
    grid.appendChild(card);

    await delay(ti===0?0:280);
    card.classList.add('visible');

    const wc=document.getElementById(`cw-${ti}`);
    for(let wi=0;wi<tierWinners.length;wi++){
      const p=tierWinners[wi];
      const chip=document.createElement('div');
      chip.className='winner-chip';
      chip.innerHTML=`<div class="chip-avatar" style="background:${p.color}22;color:${p.color};border:1px solid ${p.color}44">${p.name[0].toUpperCase()}</div><span class="chip-name">${esc(p.name)}</span>`;
      wc.appendChild(chip);
      await delay(wi*100+120);
      chip.classList.add('visible');
    }
  }

  const histEntry={
    round:state.roundNumber,
    date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),
    entries:roundEntries
  };
  state.history.unshift(histEntry);
  localStorage.setItem('dnc-round',state.roundNumber);
  renderHistory();
  renderParticipants();
  document.getElementById('btn-discord').disabled=false;
  document.getElementById('btn-run').disabled=false;
  await saveHistory(`Round ${state.roundNumber} complete`);
}

const delay=ms=>new Promise(r=>setTimeout(r,ms));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEW ROUND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function newRound() {
  openConfirm(
    'Start New Round?',
    `All winner flags will be cleared and everyone becomes eligible again. Round ${state.roundNumber} is already saved to history.`,
    ()=>{
      state.winners.clear();
      state.roundNumber++;
      state.customPrizes=[];
      state.lastResults=null;
      localStorage.setItem('dnc-round',state.roundNumber);
      renderCustomChips(); renderParticipants();
      document.getElementById('round-display').textContent=`Round ${state.roundNumber}`;
      document.getElementById('results-empty').style.display='flex';
      document.getElementById('results-grid').style.display='none';
      document.getElementById('results-grid').innerHTML='';
      document.getElementById('btn-discord').disabled=true;
      showToast(`Round ${state.roundNumber} started`,'ok');
    }
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DISCORD COPY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function copyDiscord() {
  if(!state.lastResults) return;
  const r=state.lastResults;
  const total=r.tiers.reduce((s,t)=>s+t.winners.length,0);
  const div='â”'.repeat(38);
  let msg=`ğŸ² **DEGENS N' COFFEE LOTTERY â€” ROUND ${r.round}** ğŸ²\n${div}\n`;
  for(const tier of r.tiers){
    const c=tier.winners.length;
    msg+=`\n${tier.icon} **${tier.label.toUpperCase()}** *(${c} winner${c!==1?'s':''})*\n`;
    tier.winners.forEach(w=>{msg+=`   â€¢ ${w.name}\n`;});
  }
  msg+=`\n${div}\nğŸ‰ **Congratulations to all ${total} winner${total!==1?'s':''}!**`;
  navigator.clipboard.writeText(msg).then(()=>{
    const el=document.getElementById('copy-confirm');
    el.classList.add('show');
    setTimeout(()=>el.classList.remove('show'),2500);
  }).catch(()=>showToast('Clipboard blocked â€” copy manually','err'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHistory() {
  const list=document.getElementById('history-list');
  if(!state.history.length){
    list.innerHTML='<div class="history-empty-msg">No winners recorded yet.<br>Run your first lottery!</div>';
    document.getElementById('history-badge').textContent='0';
    document.getElementById('hf-stat').textContent='0 rounds â€¢ 0 winners';
    return;
  }
  const total=state.history.reduce((s,r)=>s+r.entries.length,0);
  document.getElementById('history-badge').textContent=total;
  document.getElementById('hf-stat').textContent=`${state.history.length} rounds â€¢ ${total} winners`;
  list.innerHTML=state.history.map(round=>`
    <div class="history-round-block">
      <div class="history-round-hdr">
        <span class="hr-label">Round</span>
        <span class="hr-num">#${round.round}</span>
        <span class="hr-date">${round.date}</span>
      </div>
      ${round.entries.map(e=>`
        <div class="history-entry">
          <div class="he-dot ${e.tierClass||'custom'}"></div>
          <span class="he-name">${esc(e.name)}</span>
          <span class="he-prize">${esc(e.prize)}</span>
        </div>`).join('')}
    </div>`).join('');
  document.getElementById('round-display').textContent=`Round ${state.roundNumber}`;
}

function confirmClearHistory() {
  openConfirm(
    'Clear All History?',
    'This permanently deletes all winner records across every round. This cannot be undone.',
    async()=>{
      state.history=[];
      renderHistory();
      await saveHistory('Clear all history');
      showToast('History cleared','ok');
    }
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIRM MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _confirmCb=null;
function openConfirm(title,body,cb) {
  document.getElementById('confirm-title').textContent=title;
  document.getElementById('confirm-body').textContent=body;
  _confirmCb=cb;
  document.getElementById('confirm-overlay').classList.add('show');
}
function closeConfirm() { document.getElementById('confirm-overlay').classList.remove('show'); _confirmCb=null; }
document.getElementById('confirm-ok').addEventListener('click',()=>{closeConfirm(); if(_confirmCb)_confirmCb();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYNC STATUS / TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSyncStatus(s,label) {
  document.getElementById('sync-dot').className=`sync-dot ${s}`;
  document.getElementById('sync-label').textContent=label;
}
let _toastTimer=null;
function showToast(msg,type='info') {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast show ${type}`;
  clearTimeout(_toastTimer);
  _toastTimer=setTimeout(()=>t.classList.remove('show'),3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const esc=s=>String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const escQ=s=>String(s).replace(/\\/g,'\\\\').replace(/'/g,"\\'");

function renderAll() {
  renderParticipants();
  renderHistory();
  document.getElementById('round-display').textContent=`Round ${state.roundNumber}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(async function init(){
  loadCfg();
  if(cfg.owner&&cfg.repo){
    await loadFromGitHub();
  } else {
    setSyncStatus('err','Not configured');
    showToast('âš™ Open Settings to connect your GitHub repo','info');
    renderAll();
  }
})();
</script>
</body>
</html>
